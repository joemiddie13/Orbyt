# Session Notes — Thursday, February 13, 2026

## Summary
Full "Cozy Campfire in Space" visual redesign. Migrated from tween.js to GSAP, built Note animations, then overhauled the entire UI from light/white to dark glassmorphism. Added parallax star field, beacon glow rings, native aspect-ratio photos with drag animations, animated SVG toolbar icons, and the Satoshi typeface across everything.

---

## GSAP Migration (Phase 1)

### Why GSAP
- tween.js v25 had multiple footguns: tweens silently not running without `TWEEN.add()`, manual `TWEEN.update()` in ticker, infinite-repeat tweens needing explicit cleanup
- GSAP runs its own rAF loop (no manual update), auto-manages tween lifecycle, has built-in stagger/timeline support
- PixiPlugin integrates directly with PixiJS display objects

### Changes
- Installed `gsap`, created `src/lib/canvas/gsapInit.ts` — registers PixiPlugin + exports configured `gsap` instance
- **CanvasRenderer**: Removed `TWEEN.update()` from ticker. GSAP handles its own loop. Ticker still runs interpolation + cursor staleness.
- **BeaconObject**: Pop-in `back.out(1.7)` + pulse `sine.inOut` (repeat/-1, yoyo) + `gsap.killTweensOf()` cleanup
- **PhotoObject**: Pop-in `back.out(1.7)` — one-shot, no cleanup needed
- **StickerReaction**: Pop-in `elastic.out(1, 0.3)` + `.kill()` in destroy()
- Uninstalled `@tweenjs/tween.js` — zero remaining references in `src/`

---

## Note Animations (Phase 2 — Pillar 1)

### 1. Pop-in Entrance
- Alpha 0->1 (0.15s, `power2.out`) + scale 0->1 (0.45s, `back.out(1.4)`) — parallel
- Softer overshoot than beacons — notes "materialize" rather than bounce
- New `animate` option on `TextBlockOptions`, wired through `syncObjects`

### 2. Smooth Color Change
- RGB proxy object tween over 350ms (`power2.inOut`)
- `onUpdate` redraws background each frame (~21 redraws, just `roundRect + fill`)

### 3. Edit Mode Lift / Return
- Tap-to-edit: brief scale-up to 1.04x before DOM overlay (`power2.out`, 180ms)
- Close editor: spring back from 1.04x to 1.0 (`back.out(2)`, 300ms)

### 4. Canvas Load Stagger
- Bulk load detection: `this.objects.size === 0 && data.length > 1`
- `staggerEntrance()`: alpha + scale stagger with 60ms offset per object
- Individual pop-ins suppressed during bulk sync

---

## Cozy Campfire Redesign (Phase 3)

### Design System — `src/app.css`
- **Satoshi font** via Fontshare — set globally on body, replaced system-ui everywhere
- `.glass-panel` — dark translucent panel (`rgba(15,14,26,0.85)`) with blur + subtle white border
- `.glass-backdrop` — dimmed blurred overlay for modals
- `.glass-input` — translucent inputs with amber focus glow
- `.campfire-btn` — warm amber hover glow on action buttons
- CSP updated in `hooks.server.ts` for Fontshare CDN

### Parallax Star Field — `src/lib/canvas/StarField.ts` (NEW)
- Three-layer parallax (far/mid/near) with 225 warm-tinted stars
- Each layer offsets by different parallax factor from world pan position
- Mid layer has GSAP twinkle animation
- Renders behind world container on stage

### Canvas Visual Enhancements — `CanvasRenderer.ts`
- Star field integrated into stage, updated each tick
- Warm amber glow halo around parchment canvas bounds with breathing GSAP animation
- Softer border stroke
- Cursor username label switched to Satoshi font

### Beacon Glow — `BeaconObject.ts`
- Second outer diffuse glow ring for ambient campfire effect
- Inner + outer rings pulse independently (slower, deeper breathing)
- All text styles → Satoshi

### Photo Overhaul — `PhotoObject.ts`
- **Native aspect ratio** — photos display at actual proportions, no forced square crop
- Frame dynamically resizes to fit image
- **Drag animations**: lift (scale up + random tilt wobble), drop (squash-stretch + wobble settle)
- `destroy()` method for GSAP cleanup
- Caption font → Satoshi
- Wired `onDragStart` callback

### Animated SVG Toolbar — `CanvasToolbar.svelte`
- Three custom SVG icons replace plain `+ Note / + Beacon / + Photo` text:
  - **Note** (amber): tilted pencil + 4-point sparkle star
  - **Beacon** (orange): center dot + 2 concentric signal arcs
  - **Photo** (violet): camera body + lens circle + flash burst
- GSAP idle animations (loop forever, cleaned on destroy):
  - Sparkle breathes 0.5→1.0 (2s), beacon arcs pulse 0.4→0.8 (1.8s), lens gleams 0.3→0.7 (2.5s)
- GSAP hover animations (one-shot on mouseenter):
  - Pencil tilts + sparkle scales, arcs expand radar-ping style, flash pops + lens pulses

### Component Theming — Light to Dark Glass (10 components)
Systematic restyling across all UI panels:
- `bg-white` → `glass-panel` (dark translucent)
- `bg-black/40` backdrops → `glass-backdrop` (dimmed + blurred)
- `bg-stone-100` inputs → `glass-input`
- Text: `text-stone-*` → `text-white/*` opacity variants
- Accents: `text-amber-600` → `text-amber-400`, `bg-amber-50` → `bg-amber-500/15`
- Borders: `border-stone-*` → `border-white/[0.08]`
- Hover: `hover:bg-stone-50` → `hover:bg-white/10`

**Files:** AuthModal, BeaconDetailPanel, CanvasSwitcher, CreateBeaconModal, CreateCanvasModal, FriendCodeModal, FriendsList, InlineNoteEditor, NoteDetailPanel, PhotoActionMenu, StickerPicker

---

## Easing Reference

| Animation | GSAP Ease | Feel |
|-----------|-----------|------|
| Beacon/Photo pop-in | `back.out(1.7)` | Bouncy overshoot |
| Note pop-in | `back.out(1.4)` | Softer materialize |
| Sticker pop-in | `elastic.out(1, 0.3)` | Springy bounce |
| Beacon pulse | `sine.inOut` | Smooth breathing |
| Color change | `power2.inOut` | Natural blend |
| Edit lift | `power2.out` | Quick subtle rise |
| Edit return | `back.out(2)` | Satisfying spring-back |
| Stagger | `back.out(1.4)` + `power2.out` | Cascade pop + fade |
| Photo drag lift | scale + rotation wobble | Playful pick-up |
| Photo drag drop | squash-stretch + settle | Satisfying thud |
| Toolbar hover (note) | `power2.out` | Pencil wiggle |
| Toolbar hover (beacon) | `power2.out` | Radar ping |
| Toolbar hover (photo) | `back.out(1.4)` | Camera snap |
| Star twinkle | `sine.inOut` | Gentle shimmer |
| Canvas halo | `sine.inOut` | Warm breathing glow |

---

## Files Changed

| File | Change |
|------|--------|
| `src/app.css` | Satoshi font, glass-panel/backdrop/input/btn utility classes |
| `src/hooks.server.ts` | CSP allow Fontshare CDN |
| `src/lib/canvas/StarField.ts` | **NEW** — 3-layer parallax star field |
| `src/lib/canvas/gsapInit.ts` | **NEW** — GSAP + PixiPlugin registration |
| `src/lib/canvas/CanvasRenderer.ts` | Star field, canvas halo, TWEEN removal, stagger, Satoshi |
| `src/lib/canvas/objects/BeaconObject.ts` | GSAP migration, dual glow rings, Satoshi |
| `src/lib/canvas/objects/PhotoObject.ts` | Native aspect ratio, drag animations, destroy(), Satoshi |
| `src/lib/canvas/objects/TextBlock.ts` | GSAP pop-in/color/edit animations, Satoshi |
| `src/lib/canvas/objects/StickerReaction.ts` | GSAP migration |
| `src/lib/components/CanvasToolbar.svelte` | SVG icons + GSAP idle/hover animations + dark theme |
| `src/lib/components/AuthModal.svelte` | Dark glass theme |
| `src/lib/components/BeaconDetailPanel.svelte` | Dark glass theme |
| `src/lib/components/CanvasSwitcher.svelte` | Dark glass theme |
| `src/lib/components/CreateBeaconModal.svelte` | Dark glass theme |
| `src/lib/components/CreateCanvasModal.svelte` | Dark glass theme |
| `src/lib/components/FriendCodeModal.svelte` | Dark glass theme |
| `src/lib/components/FriendsList.svelte` | Dark glass theme |
| `src/lib/components/InlineNoteEditor.svelte` | Dark glass theme |
| `src/lib/components/NoteDetailPanel.svelte` | Dark glass theme + swatch adjustments |
| `src/lib/components/PhotoActionMenu.svelte` | Dark glass theme |
| `src/lib/components/StickerPicker.svelte` | Dark glass theme |
| `.claude/skills/frontend-design` | **NEW** — Anthropic frontend-design skill |

---

## Skills Installed
- `frontend-design` from `github.com/anthropics/skills` — design quality guidance for Claude Code

---

## Status
- GSAP migration: complete
- Note animations (Pillar 1): complete
- Cozy Campfire in Space redesign: complete (all components themed)
- Parallax star field: complete
- Animated SVG toolbar: complete
- Satoshi typeface: complete (global + all PixiJS text)
- Build passes clean, no new type errors
- Next: music link cards, Rive animations, demo prep
