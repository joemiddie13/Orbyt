# Session Notes — Thursday, February 13, 2026

## Summary
Animation overhaul day. Migrated from tween.js to GSAP across the entire project, then built out Note animations as the first of four "pillars" (Notes, Beacons, Photos, Music). GSAP eliminates tween.js v25 footguns (manual `TWEEN.add()`, manual `TWEEN.update()`, infinite tween cleanup bugs) and gives us timelines, stagger, and better easing.

---

## GSAP Migration (Phase 1)

### Why GSAP
- tween.js v25 had multiple footguns: tweens silently not running without `TWEEN.add()`, manual `TWEEN.update()` in ticker, infinite-repeat tweens needing explicit cleanup
- GSAP runs its own rAF loop (no manual update), auto-manages tween lifecycle, has built-in stagger/timeline support
- PixiPlugin integrates directly with PixiJS display objects

### Changes
- Installed `gsap`, created `src/lib/canvas/gsapInit.ts` — registers PixiPlugin + exports configured `gsap` instance
- **CanvasRenderer**: Removed `TWEEN.update()` from ticker. GSAP handles its own loop. Ticker still runs interpolation + cursor staleness.
- **BeaconObject**: Pop-in `back.out(1.7)` + pulse `sine.inOut` (repeat/-1, yoyo) + `gsap.killTweensOf()` cleanup
- **PhotoObject**: Pop-in `back.out(1.7)` — one-shot, no cleanup needed
- **StickerReaction**: Pop-in `elastic.out(1, 0.3)` + `.kill()` in destroy()
- Uninstalled `@tweenjs/tween.js` — zero remaining references in `src/`

---

## Note Animations (Phase 2 — Pillar 1)

### 1. Pop-in Entrance
- Notes were the only object type with no entrance animation
- Alpha 0->1 (0.15s, `power2.out`) + scale 0->1 (0.45s, `back.out(1.4)`) — parallel
- Softer overshoot than beacons — notes "materialize" rather than bounce
- New `animate` option on `TextBlockOptions`, wired through `syncObjects`

### 2. Smooth Color Change
- Previously instant redraw when switching colors
- RGB proxy object tween over 350ms (`power2.inOut`)
- `onUpdate` redraws background each frame (~21 redraws, just `roundRect + fill`)

### 3. Edit Mode Lift
- Brief "lift" when tapping to edit, before DOM overlay takes over
- `animateEditLift(): Promise<void>` — scale to 1.04x in 180ms (`power2.out`), then hides container
- `+page.svelte`: `await block.animateEditLift()` before showing InlineNoteEditor

### 4. Edit Mode Return
- Note springs back when editor closes
- `animateEditReturn()` — starts at 1.04x/70% alpha, springs to 1.0 with `back.out(2)` in 300ms
- Called in `closeInlineEditor()` in `+page.svelte`

### 5. Canvas Load Stagger
- Objects cascade in on load instead of all appearing at once
- Bulk load detection: `this.objects.size === 0 && data.length > 1`
- Individual pop-ins suppressed during bulk sync
- `staggerEntrance()`: alpha + scale stagger with 60ms offset per object
- Single additions still get normal pop-in

---

## Easing Reference

| Animation | GSAP Ease | Feel |
|-----------|-----------|------|
| Beacon/Photo pop-in | `back.out(1.7)` | Bouncy overshoot |
| Note pop-in | `back.out(1.4)` | Softer materialize |
| Sticker pop-in | `elastic.out(1, 0.3)` | Springy bounce |
| Beacon pulse | `sine.inOut` | Smooth breathing |
| Color change | `power2.inOut` | Natural blend |
| Edit lift | `power2.out` | Quick subtle rise |
| Edit return | `back.out(2)` | Satisfying spring-back |
| Stagger | `back.out(1.4)` + `power2.out` | Cascade pop + fade |

---

## Files Changed

| File | Change |
|------|--------|
| `src/lib/canvas/gsapInit.ts` | **NEW** — GSAP + PixiPlugin registration |
| `src/lib/canvas/CanvasRenderer.ts` | TWEEN removal, gsapInit import, stagger entrance, bulk load detection |
| `src/lib/canvas/objects/BeaconObject.ts` | tween.js -> GSAP (pop-in + pulse + cleanup) |
| `src/lib/canvas/objects/PhotoObject.ts` | tween.js -> GSAP (pop-in) |
| `src/lib/canvas/objects/StickerReaction.ts` | tween.js -> GSAP (pop-in + cleanup) |
| `src/lib/canvas/objects/TextBlock.ts` | GSAP import, pop-in, color transition, edit lift/return |
| `src/routes/+page.svelte` | async edit lift in onNoteTapped, animateEditReturn in closeInlineEditor |
| `package.json` / `package-lock.json` | +gsap, -@tweenjs/tween.js |

---

## Status
- GSAP migration: complete (all tween.js references removed)
- Note animations (Pillar 1): complete (pop-in, color, edit lift/return, stagger)
- Build passes clean, no new type errors
